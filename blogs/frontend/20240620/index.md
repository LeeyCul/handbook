---
title: ä» 0 æ­å»ºä¸€ä¸ªè„šæ‰‹æ¶
date: 2023/06/23
tags:
  - è„šæ‰‹æ¶
categories:
  - å‰ç«¯
---

# åº

**ä¸ºä»€ä¹ˆè¦è‡ªå·±æ­å»ºé¡¹ç›® ï¼Ÿ**

è¿™ä¸ªäº‹æƒ…èµ·å§‹äºå‰ä¸¤å¤©ç»™å›¢é˜Ÿå†™ä¸€ä¸ªè„šæ‰‹æ¶å·¥å…·ï¼Œè¿™æ®µæ—¶é—´åˆšåšåšå®Œä¸€ä¸ªç³»ç»Ÿï¼Œæ˜¯å›¢é˜Ÿç¬¬ä¸€ä¸ªæ­£å¼æ„ä¹‰ä¸Šçš„å…¨æ ˆé¡¹ç›®ï¼›å›¢é˜Ÿæœ‰è‡ªå·±çš„å‰ç«¯è„šæ‰‹æ¶ï¼Œä½†æ˜¯æ²¡æœ‰åç«¯è„šæ‰‹æ¶ï¼Œæ‰€ä»¥æƒ³ç€ç»™å›¢é˜Ÿå†™ä¸€ä¸ªåç«¯è„šæ‰‹æ¶å·¥å…·ï¼Œè¿™æ ·å›¢é˜Ÿåœ¨å¼€å±•åç»­çš„å…¨æ ˆé¡¹ç›®æ—¶å¯ä»¥ä½¿ç”¨è„šæ‰‹æ¶æ„å»ºé¡¹ç›®ï¼Œé¿å…äº†é‡å¤æ­å»ºé¡¹ç›®åˆå§‹æ¶æ„çš„å¤§é‡å·¥ä½œï¼Œæˆå‘˜ç›´æ¥ç¼–å†™ä¸šåŠ¡ä»£ç å³å¯ã€‚
å‰ä¸¤å¤©ç”¨ JavaScript å®Œæˆäº†è„šæ‰‹æ¶çš„åˆç‰ˆï¼Œå¼€å‘è¿‡ç¨‹ä¸­å‘ç°æ²¡ä¸€ç‚¹ä»£ç æç¤ºï¼Œå¾ˆä¸èˆ’æœï¼Œè€Œä¸”è¿™æ ·çš„ä»£ç ä¸åˆ©äºåç»­çš„è¿­ä»£å’Œç»´æŠ¤ã€‚
æ‰€ä»¥å†³å®šç”¨ typescript é‡æ„ä¸€éï¼Œä½†æ˜¯å®˜æ–¹å¥½åƒæ²¡æœ‰æä¾›ä¸€ä¸ªåˆé€‚çš„è„šæ‰‹æ¶å·¥å…·ï¼Œäºæ˜¯å°±å¼€å§‹è‡ªå·±æ­å»º typescript é¡¹ç›®ï¼›è‡ªå·±æ­å»ºæœ€å¤§çš„å¥½å¤„å°±æ˜¯ è‡ªä¸»å¯æ§ï¼Œé¡¹ç›®ä¸­é›†æˆäº†å®æ—¶ç¼–è¯‘çš„å¼€å‘ç¯å¢ƒã€eslint + prettier ä¿è¯ä»£ç è´¨é‡å’Œé£æ ¼ç»Ÿä¸€ã€é¡¹ç›®æ„å»ºå·¥å…·ã€git æäº¤ä¿¡æ¯çš„è§„èŒƒåŒ–ï¼Œè¿™äº›éƒ½æ˜¯ä¸€ä¸ªé¡¹ç›®æœ€åŸºæœ¬å’Œå¿…è¦çš„é…ç½®ã€‚
æœ¬æ¥åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œä½†æ˜¯åœ¨åç»­é‡æ„è„šæ‰‹æ¶çš„è¿‡ç¨‹ä¸­å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæ¯å†™ä¸€ä¸ªæ–°çš„ typescript é¡¹ç›®å°±é‡å¤ä¸€éè¿™ä¸ªæ­å»ºæµç¨‹ï¼Œæ¯”å¦‚ï¼šä»Šå¤©éœ€è¦å¼€å‘ä¸€ä¸ª npm åŒ…ï¼Œæ˜å¤©éœ€è¦å¼€å‘å¦å¤–ä¸€ä¸ªè„šæ‰‹æ¶ï¼Œè¿™å¥½åƒæœ‰ç‚¹å¤ªéº»çƒ¦äº†ï¼Œäºæ˜¯å°±æŠŠæ•´ä¸ªæ­å»ºè¿‡ç¨‹å†™æˆäº†ä¸€ä¸ªè„šæ‰‹æ¶ï¼Œè¿™æ ·åœ¨åç»­å¼€å‘çš„å·¥ä½œä¸­å°±å¯ä»¥å®ç°ä¸€é”®åˆ›å»ºé¡¹ç›®ï¼Œç®€å•ã€æ–¹ä¾¿ã€èˆ’çˆ½

## æ­å»ºé¡¹ç›®

### 1ã€åˆå§‹åŒ–é¡¹ç›®

```
mkdir ts-project && cd ts-project && npm init -y && npm i typescript -D && npx tsc --init
```

è¿™æ¡å‘½ä»¤çš„æ„æ€æ˜¯åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª ts-project ç›®å½•ï¼Œç„¶åè¿›å…¥ ts-project ç›®å½•æ‰§è¡Œ npm init -y åˆå§‹è¯ç›®å½•äº§ç”Ÿ package.json æ–‡ä»¶ï¼Œä¹‹åè¿è¡Œ npm i typescript -D åœ¨å¼€å‘ç¯å¢ƒå®‰è£… typescript åŒ…ï¼Œä¹‹åæ‰§è¡Œ npx tsc --init ç”Ÿæˆ tsconfig.json æ–‡ä»¶ã€‚

```
mkdir src && touch src/index.ts
```

æ–°å»º src ç›®å½•ä½œä¸ºé¡¹ç›®çš„æºç ç›®å½•ï¼ˆå¼€å‘ç›®å½•ï¼‰ï¼Œå¹¶åœ¨ src ç›®å½•ä¸‹åˆ›å»º index.ts æ–‡ä»¶ä½œä¸ºé¡¹ç›®çš„å…¥å£æ–‡ä»¶

### 2ã€è®¾ç½® tsconfig.json

å¦‚æœä¸€ä¸ªç›®å½•ä¸‹å­˜åœ¨ tsconfig.json æ–‡ä»¶ï¼Œé‚£å°±æ„å‘³ç€è¿™ä¸ªç›®å½•æ˜¯ typescirpt é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œtsconfig.json æ–‡ä»¶ä¸­æŒ‡å®šäº†ç”¨æ¥ç¼–è¯‘é¡¹ç›®çš„æ ¹æ–‡ä»¶å’Œç¼–è¯‘é€‰é¡¹ï¼Œä½¿ç”¨ tsc --init ç”Ÿæˆçš„ tsconfig.json æ–‡ä»¶åŒ…å«äº†å¤§é‡çš„é€‰é¡¹ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†éƒ½è¢«æ³¨é‡Šæ‰äº†ï¼Œä¸€èˆ¬æˆ‘ä»¬åªéœ€è¦é…ç½®å¦‚ä¸‹å†…å®¹å³å¯

```json
{
  "compileOnSave": true,
  "compilerOptions": {
    "target": "ES2018",
    "module": "commonjs",
    "moduleResolution": "node",
    "experimentalDecorators": true,
    "emitDecoratorMetadata": true,
    "inlineSourceMap": true,
    "noImplicitThis": true,
    "noUnusedLocals": true,
    "stripInternal": true,
    "pretty": true,
    "declaration": true,
    "outDir": "lib",
    "baseUrl": "./",
    "paths": {
      "*": ["src/*"]
    }
  },
  "exclude": ["lib", "node_modules"]
}
```

### 3ã€ä¸‹è½½@types/node

```
npm i ts-node-dev -D
```

åœ¨ package.json çš„ scripts ä¸­å¢åŠ å¦‚ä¸‹å†…å®¹

```json
 "scripts": {
    "build": "rm -rf lib && tsc --build",
    "start": "ts-node-dev --respawn --transpile-only src/index.ts sr",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
```

æ‰§è¡Œ npm run start å³å¯å¯åŠ¨å¼€å‘ç¯å¢ƒï¼Œå¹¶ä¸”ä¿®æ”¹æ–‡ä»¶æ—¶å¯å®æ—¶ç¼–è¯‘ã€‚

å¥½äº†ï¼Œåˆ°è¿™é‡Œé¡¹ç›®å°±æ­å»ºå¥½äº†ï¼Œè™½ç„¶è¿˜æœ‰ä¸€äº›å¯ä¼˜åŒ–å’Œæ‰©å±•çš„åœ°æ–¹ï¼Œä½†æ˜¯ç”¨äºå¼€å‘ä¸€ä¸ªç®€å•çš„ npm åŒ…æˆ–è€…è„šæ‰‹æ¶çš„é¡¹ç›®æ¥è¯´å·²ç»è¶³å¤Ÿäº†ï¼Œå¦‚æœ‰éœ€è¦å¯ä»¥åŸºäºä»¥ä¸Šå†…å®¹å†è¿›è¡Œè¿›ä¸€æ­¥çš„è¡¥å……å’Œæ‰©å±•ï¼Œå¸Œæœ›å¤§å®¶èƒ½ä»é‡Œé¢å¾—åˆ°è‡ªå·±éœ€è¦çš„å†…å®¹ã€‚

## è„šæ‰‹æ¶å‡†å¤‡å·¥ä½œ

**å¸¸ç”¨å·¥å…·åŒ…**

```
"chalk": "^4.1.0",  // ç²‰é¥°ä½ çš„ç»ˆç«¯ï¼Œç»™ä½ çš„ç»ˆç«¯æ–‡å­—æ·»åŠ æ ·å¼
"clear-console": "^1.1.0", // æ¸…ç©ºå‘½ä»¤è¡Œçš„å½“å‰ç•Œé¢ï¼Œç±»ä¼¼äºæµè§ˆå™¨æ§åˆ¶å°çš„ clear() å’Œ å‘½ä»¤è¡Œä¸‹çš„ clear
"commander": "^6.2.0", // å®Œæ•´çš„ node.js å‘½ä»¤è¡Œè§£å†³æ–¹æ¡ˆ
"download-git-repo": "^3.0.2", // è®©ä½ å¯ä»¥ä½¿ç”¨ node.js ä» git ä»“åº“ä¸‹è½½ä»£ç ï¼Œä¸è¿‡æˆ‘è¿™é‡Œä¸‹äº†gitlabæœ‰é—®é¢˜ï¼Œæˆ‘ç”¨çš„å…¶ä»–æ–¹æ³•
"inquirer": "^7.3.3", // é€šç”¨äº¤äº’å¼å‘½ä»¤è¡Œç”¨æˆ·ç•Œé¢ï¼Œæ”¶é›†ç”¨æˆ·çš„é€‰æ‹©
"ora": "^5.4.1" //è¿›ä¸€æ­¥ä¸°å¯Œä½ çš„å‘½ä»¤è¡Œï¼Œæ”¯æŒæ·»åŠ ä¸€äº›å›¾æ ‡ã€åŠ¨æ•ˆloading
```

## æœ¬åœ°è°ƒè¯•

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ pacakge.json ä¸­å¢åŠ å¦‚ä¸‹å†…å®¹ï¼š

```
"bin": {
    "hxgy-create-app": "./bin/cli"
  },
```

bin è¡¨ç¤ºå‘½ä»¤(ts-cli)çš„å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®ï¼Œæ¥ä¸‹æ¥åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ npm linkï¼Œå°† package.json ä¸­çš„å±æ€§ bin çš„å€¼è·¯å¾„æ·»åŠ å…¨å±€é“¾æ¥ï¼Œåœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ ts-cli å°±ä¼šæ‰§è¡Œ ./bin/ts-cli.js æ–‡ä»¶
å½“ç”¨æˆ·å®‰è£…å¸¦æœ‰ bin å­—æ®µçš„åŒ…æ—¶ï¼Œå¦‚æœæ˜¯å…¨å±€å®‰è£…ï¼Œnpm å°†ä¼šä½¿ç”¨ç¬¦å·é“¾æ¥æŠŠè¿™äº›æ–‡ä»¶é“¾æ¥åˆ°/usr/local/node_modules/.bin/(å³å…¨å±€çš„ node_modules/.bin ä¸­)ï¼›å¦‚æœæ˜¯æœ¬åœ°å®‰è£…ï¼Œä¼šé“¾æ¥åˆ°./node_modules/.bin/ã€‚
å¼€å‘ç»“æŸå¯æ‰§è¡Œ npm unlink ts-cli å»æ‰ ts-cli çš„é“¾æ¥ï¼Œå¦‚æœä¸å¹¸ä½ æ‰§è¡Œ npm link å‘½ä»¤ä¹‹åä½ æ”¹å˜äº†ä½ çš„ç›®å½•åï¼Œåœ¨ unlink æ—¶ä¼šæ— æ•ˆï¼Œåªèƒ½æ‰‹åŠ¨å»å…¨å±€çš„ node_modules ä¸­åˆ é™¤å¯¹åº”çš„è½¯è¿æ¥
åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ·»åŠ  bin ç›®å½•ï¼Œç„¶ååœ¨ bin ç›®å½•ä¸‹æ–°å»º ts-cli.jsï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

```
#!/usr/bin/env node
require("../lib/index");
```

![alt text](image.png)

## /src/index.ts

```ts
import { program } from "commander";
import create from "./order/create";
import chalk from "chalk";

const pkg = require("../package.json");
program
  .version(pkg.version, "-v --version")
  .name(pkg.name)
  .option("-f, --framework", "æŒ‡å®šåˆ›å»ºé¡¹ç›®çš„æ¡†æ¶ï¼Œç›®å‰åªæ”¯æŒVue")
  .usage("<app-name> [options]");
program
  .arguments("<app-name>")
  .description(`${chalk.cyan("åˆ›å»ºé¡¹ç›® => hxgy-create-app ProjectName")}`)
  .action(async (name: string) => {
    await create(name);
  });

program.parse(process.argv);
```

## /src/order/create.ts

```ts
import {
  changePackageInfo,
  end,
  isFileExist,
  selectFeature,
} from "../utils/create";
import chalk from "chalk";
import { download } from "./download";

// create å‘½ä»¤
export default async function create(projecrName: string): Promise<void> {
  try {
    // åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å·²ç»å­˜åœ¨
    isFileExist(projecrName);
    // é€‰æ‹©ç‰ˆæœ¬
    const feature = await selectFeature();
    download({ projecrName, feature });
    changePackageInfo(projecrName);
    end(projecrName);
  } catch (err) {
    console.log(chalk.red(err));
  }
}
```

## /src/order/download.ts

```ts
import ora from "ora";
import { red } from "chalk";
// import downloadGitRepo from 'download-git-repo';

const child_process = require("child_process");
const { execSync } = child_process;

interface GitRepoProps {
  projecrName: string;
  feature: string;
}

const VersionTypeMap = new Map([
  ["ts", "git@192.168.168.19:ehospital/03-cpfh/template/hxgy-template-web.git"],
  // ['js','github:yangzongzhuan/RuoYi-Vue3']
  ["js", "https://github.com/yangzongzhuan/RuoYi-Vue3.git"],
]);
export const download = async ({ projecrName, feature }: GitRepoProps) => {
  const spinner = ora("æ­£åœ¨æ‹‰å–æ¨¡ç‰ˆ...");
  try {
    spinner.start();
    await execSync(`git clone ${VersionTypeMap.get(feature)} ${projecrName}`, {
      stdio: "inherit",
    });
    spinner.stop();
  } catch (err) {
    spinner.stop();
    console.log(red(`\n âŒ   ${err}\n`));
    process.exit(1);
  }
};
```

## src/utils/common.ts

```ts
/**
 * æ”¾ä¸€äº›é€šç”¨çš„å·¥å…·æ–¹æ³•
 */
import { readFileSync, writeFileSync } from "fs";
import { resolve } from "path";
const clear = require("clear-console");

export interface PackageJSON {
  name: string;
  version: string;
  description: string;
  scripts: {
    [key: string]: string;
  };
}

export interface JSON {
  [key: string]: unknown;
}

/**
 * è¯»å–æŒ‡å®šè·¯å¾„ä¸‹ json æ–‡ä»¶
 * @param filename json æ–‡ä»¶çš„è·¯å¾„
 */
export function readJsonFile<T>(filename: string): T {
  return JSON.parse(readFileSync(filename, { encoding: "utf-8", flag: "r" }));
}

/**
 * è¦†å†™æŒ‡å®šè·¯å¾„ä¸‹çš„ json æ–‡ä»¶
 * @param filename json æ–‡ä»¶çš„è·¯å¾„
 * @param content  json å†…å®¹
 */
export function writeJsonFile<T>(filename: string, content: T): void {
  writeFileSync(filename, JSON.stringify(content, null, 2));
}

/**
 * è·å–é¡¹ç›®ç»å¯¹è·¯å¾„
 * @param projectName é¡¹ç›®å
 */
export function getProjectPath(projectName: string): string {
  return resolve(process.cwd(), projectName);
}

/**
 * æ‰“å°ä¿¡æ¯
 * @param msg ä¿¡æ¯
 */
export function printMsg(msg: string): void {
  console.log(msg);
}

/**
 * æ¸…ç©ºå‘½ä»¤è¡Œ
 */
export function clearConsole(): void {
  clear();
}
```

## src/utils/create.ts

```ts
/**
 * create å‘½ä»¤éœ€è¦ç”¨åˆ°çš„æ‰€æœ‰æ–¹æ³•
 */
import {
  getProjectPath,
  PackageJSON,
  printMsg,
  readJsonFile,
  writeJsonFile,
  clearConsole,
} from "../utils/common";
import { existsSync } from "fs";
import { prompt } from "inquirer";
import { blue, cyan, gray, red, yellow } from "chalk";

/**
 * éªŒè¯å½“å‰ç›®å½•ä¸‹æ˜¯å¦å·²ç»å­˜åœ¨æŒ‡å®šæ–‡ä»¶ï¼Œå¦‚æœå­˜åœ¨åˆ™é€€å‡ºè¿›è¡Œ
 * @param filename æ–‡ä»¶å
 */
export function isFileExist(filename: string): void {
  // æ–‡ä»¶è·¯å¾„
  const file = getProjectPath(filename);
  // éªŒè¯æ–‡ä»¶æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå­˜åœ¨åˆ™æ¨å‡ºè¿›ç¨‹
  if (existsSync(file)) {
    printMsg(red(`${file} å·²ç»å­˜åœ¨`));
    process.exit(1);
  }
}

/**
 * äº¤äº’å¼å‘½ä»¤è¡Œï¼Œè®©ç”¨æˆ·è‡ªå·±é€‰æ‹©éœ€è¦çš„åŠŸèƒ½
 * return string
 */
export async function selectFeature(): Promise<string> {
  // æ¸…ç©ºå‘½ä»¤è¡Œ
  clearConsole();
  // è¾“å‡ºä¿¡æ¯
  printMsg(blue(`TS CLI v${require("../../package.json").version}`));
  printMsg("å¼€å§‹åˆå§‹åŒ–é¡¹ç›®:");
  printMsg("");
  const { feature } = await prompt([
    {
      name: "feature",
      type: "list",
      message: "è¯·é€‰æ‹©é¡¹ç›®ç±»å‹",
      choices: [
        { name: "TypeScript", value: "ts" },
        { name: "JavaScript", value: "js" },
      ],
    },
  ]);
  return feature;
}

/**
 * æ”¹å†™é¡¹ç›®ä¸­ package.json çš„ nameã€description
 */
export function changePackageInfo(projectName: string): void {
  const packageJSON: PackageJSON = readJsonFile<PackageJSON>(
    `./${projectName}/package.json`
  );
  packageJSON.name = packageJSON.description = projectName;
  writeJsonFile<PackageJSON>(`./${projectName}/package.json`, packageJSON);
}

/**
 * æ•´ä¸ªé¡¹ç›®å®‰è£…ç»“æŸï¼Œç»™ç”¨æˆ·æç¤ºä¿¡æ¯
 */
export function end(projectName: string): void {
  printMsg("");
  printMsg("");
  printMsg(`âœ… Successfully created project ${yellow(projectName)}`);
  printMsg("");
  printMsg(`${gray("$")} ${cyan("cd " + projectName)}`);
  printMsg(`${gray("$")} ${cyan("npm run dev")}`);
  printMsg("");
}
```

## æ„å»ºã€å‘å¸ƒ

æ‰§è¡Œ npm run build è¿›è¡Œæ„å»ºï¼Œä¿®æ”¹ package.json ä¸­çš„å¦‚ä¸‹å†…å®¹

```json
{
  "name": "@hxgy/create-app-cli",
  "version": "1.1.8",
  "description": "@hxgy/create-app-cli",
  "main": "./lib/index.js",
  "bin": {
    "hxgy-create-app": "./bin/cli"
  },
  "scripts": {
    "build": "rm -rf lib && tsc --build",
    "start": "ts-node-dev --respawn --transpile-only src/index.ts sr",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "files": ["bin", "lib", "README.md"],
  "keywords": ["å‰ç«¯è„šæ‰‹æ¶"],
  "author": "hongpeiLee",
  "license": "ISC",
  "dependencies": {
    "chalk": "^4.1.0",
    "clear-console": "^1.1.0",
    "commander": "^6.2.0",
    "download-git-repo": "^3.0.2",
    "inquirer": "^7.3.3",
    "ora": "^5.4.1",
    "shelljs": "^0.8.5",
    "util": "^0.12.5"
  },
  "devDependencies": {
    "@types/node": "^14.14.10",
    "ts-node-dev": "^2.0.0",
    "typescript": "^4.1.2"
  }
}
```

- name: åŒ…åï¼Œåœ¨åŒ…åç§°å‰åŠ è‡ªå·±çš„ npm è´¦æˆ·åï¼Œé‡‡ç”¨ npm scope çš„æ–¹å¼ï¼ŒåŒ…ç›®å½•çš„ç»„ç»‡æ–¹å¼å’Œæ™®é€šåŒ…ä¸ä¸€æ ·ï¼Œè€Œä¸”å¯ä»¥æœ‰æ•ˆçš„é¿å…å’Œä»–äººçš„åŒ…åå†²çª
- mainï¼šè¡¨ç¤ºåŒ…çš„å…¥å£ä½ç½®
- keywordsï¼šå…³é”®å­—ï¼Œæ–¹é¢åˆ«äººæœç´¢åˆ°ä½ çš„åŒ…
- filesï¼šå‘Šè¯‰ npmï¼Œpublish æ—¶å‘å¸ƒå“ªäº›åŒ…åˆ° npm ä»“åº“
- repositoryï¼šé¡¹ç›®ä»“åº“

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å¢åŠ ä¸€ä¸ªå‘å¸ƒè„šæœ¬ publish.sh

```
#!/bin/bash

echo 'å¼€å§‹æ„å»ºè„šæ‰‹æ¶'

npm run build

echo 'è„šæ‰‹æ¶æ„å»ºå®Œæˆï¼Œç°åœ¨å‘å¸ƒ'

npm publish --access public
```

è¿™æ ·å­å°±å·²ç»å®Œæˆï¼**å®Œç»“æ’’èŠ± ğŸ‰ğŸ‰ğŸ‰**
